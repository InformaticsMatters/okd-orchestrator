

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Creating a Cluster &mdash; The OKD Orchestrator 1.0.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Destroying a Cluster" href="destroying-your-cluster.html" />
    <link rel="prev" title="Compiling Machine Images for AWS" href="compiling-machine-images-for-aws.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> The OKD Orchestrator
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting-started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting-started-aws.html">Getting Started with AWS</a></li>
<li class="toctree-l1"><a class="reference internal" href="compiling-machine-images.html">Compiling Machine Images</a></li>
<li class="toctree-l1"><a class="reference internal" href="compiling-machine-images-for-aws.html">Compiling Machine Images for AWS</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Creating a Cluster</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#creating-the-cluster">Creating the Cluster</a></li>
<li class="toctree-l2"><a class="reference internal" href="#installing-openshift">Installing OpenShift</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cluster-state-files">Cluster State Files</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="destroying-your-cluster.html">Destroying a Cluster</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Frequently Asked Questions</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">The OKD Orchestrator</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Creating a Cluster</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/creating-your-cluster.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="creating-a-cluster">
<h1>Creating a Cluster<a class="headerlink" href="#creating-a-cluster" title="Permalink to this headline">¶</a></h1>
<p>Orchestration currently consists of two steps: orchestrating the
<strong>Cluster</strong> and then installing the OpenShift <strong>OKD software</strong>.
All of this can be accomplished from within the orchestrator’s Docker
container.</p>
<div class="section" id="creating-the-cluster">
<h2>Creating the Cluster<a class="headerlink" href="#creating-the-cluster" title="Permalink to this headline">¶</a></h2>
<blockquote class="epigraph">
<div>If you’ve made any local changes to the Orchestrator files you should
commit them to revision control now. Your repository is cloned to the
Bastion as the cluster ius created so checking them in now means it will
get an <em>up to date</em> copy of your files.</div></blockquote>
<p>If you’re not already in the orchestration container you can start and enter
it with the convenient start script in the root of the project:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ ./orc-start.sh
</pre></div>
</div>
<p>If you haven’t done so already you need to set the password that will be
assigned to the OpenShift <strong>admin</strong> account the orchestrator creates. Choose
a suitable value and set it in your <code class="docutils literal notranslate"><span class="pre">setenv.sh</span></code> script, replacing
the value for:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>TF_VAR_okd_admin_password
</pre></div>
</div>
<p>If the SSH key-pair you are using (named in your <code class="docutils literal notranslate"><span class="pre">setenv.sh</span></code>) is not
the default (i.e. <cite>id_rsa</cite>) then you will need to run <cite>ssh-agent</cite> in the
container to allow some stages of orchestration to run without prompting:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ eval $(ssh-agent)
$ ssh-add ~/.ssh/aws-keypair
</pre></div>
</div>
<p>Now, to create the cluster (bastion, network and OpenShift nodes)
set your environment variables and run the <code class="docutils literal notranslate"><span class="pre">create.py</span></code> utility using
the <code class="docutils literal notranslate"><span class="pre">--cluster</span></code> option:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ source provider-env/setenv.sh
$ ./create.py --cluster
+---------------------------------------------------+
| Simple AWS Deployment (OpenShift 3.9) [Frankfurt] |
+---------------------------------------------------+
Enter &quot;okay&quot; to CREATE the Cluster:
</pre></div>
</div>
<p>If there’s more than one deployment configuration in the project
you’ll need to name the one you want to create, i.e.:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./create.py --cluster simple-aws-frankfurt-3.9
+---------------------------------------------------+
| Simple AWS Deployment (OpenShift 3.9) [Frankfurt] |
+---------------------------------------------------+
Enter &quot;okay&quot; to CREATE the Cluster:
</pre></div>
</div>
<p>Respond to the warning prompt to confirm the action and the creation process
will begin.</p>
<p>Creating the Cluster will take a few minutes.</p>
<p>When complete the public IP address of the bastion (and the master and
infrastructure nodes) will be presented to you. You should see a
<code class="docutils literal notranslate"><span class="pre">terraform</span> <span class="pre">output</span></code> banner with the relevant addresses printed below.
The address of the bastion is needed for the next step:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>+----------------------+
| terraform output ... |
+----------------------+
bastion_ip = 18.185.149.91
openshift_infra_ip = 35.157.131.211
openshift_master_ip = 18.184.254.113
</pre></div>
</div>
</div>
<div class="section" id="installing-openshift">
<h2>Installing OpenShift<a class="headerlink" href="#installing-openshift" title="Permalink to this headline">¶</a></h2>
<p>The cluster creation step places a clone of your orchestrator project is in the
Bastion’s home directory. Installation of OpenShift takes place from there.</p>
<p>You can <code class="docutils literal notranslate"><span class="pre">ssh</span></code> to the Bastion from within the orchestration container you’re
currently in using the public IP address of the bastion presented to you in
the previous step.</p>
<p><code class="docutils literal notranslate"><span class="pre">ssh</span></code> to the Bastion using the built-in <code class="docutils literal notranslate"><span class="pre">centos</span></code> account. for the above
you’d run:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ ssh centos@18.185.149.91
</pre></div>
</div>
<p>From the Bastion you simply move to the cloned orchestrator directory and run
<code class="docutils literal notranslate"><span class="pre">create.py</span></code> again, this time using the <code class="docutils literal notranslate"><span class="pre">--openshift</span></code> command-line option,
to install the OpenShift element of the cluster:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ cd okd-orchestrator
$ ./create.py --openshift
+---------------------------------------------------+
| Simple AWS Deployment (OpenShift 3.9) [Frankfurt] |
+---------------------------------------------------+
Enter &quot;go&quot; to INSTALL OpenShift:
</pre></div>
</div>
<p>Acknowledge the warning prompt to begin the installation.</p>
<p>If there’s more than one deployment configuration in your project you will
need to name the configuration to use for the OpenShift installation.</p>
<blockquote class="epigraph">
<div><p>You do not need to set any environment variables on the bastion or
use <code class="docutils literal notranslate"><span class="pre">ssh-agent</span></code> as it and your variables are automatically configured
on the Bastion as part of the cluster creation step.</p>
<p>It may take a significant period fo time to install OpenShift, depending on
the configuration (i.e., the size of the cluster and whether logging,
metrics, gluster etc. are also being installed). You should allow around
30 minutes for a typical small configuration.</p>
<p>The basic AWS example will be finished after approximately <strong>14 minutes</strong>.</p>
</div></blockquote>
<p>Once <code class="docutils literal notranslate"><span class="pre">create.py</span></code> is complete, your OKD Cluster should be installed with a
console available on the IP address or domain name that’s routed to the Master
node, i.e. the address used for the deployment’s <code class="docutils literal notranslate"><span class="pre">cluster.public_hostname</span></code> or
via the IP address presented to you when the cluster was created.</p>
<p>You’re connected to the bastion, when the cluster’s complete you can exit
and return  to the orchestration container:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ exit
</pre></div>
</div>
<p>Using the terraform output from the cluster creation stage you
should see the OpenShift Master IP address. In the above example you’ll
find the master’s console at:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>https://18.184.254.113
</pre></div>
</div>
<p>You should be able to login as <code class="docutils literal notranslate"><span class="pre">admin</span></code> using the password you used
in your <code class="docutils literal notranslate"><span class="pre">setenv.sh</span></code> script.</p>
<blockquote>
<div>The Bastion is no longer needed once your cluster has been deployed and
so you can <strong>stop</strong> it, if your cloud provider provides this functionality.
This will reduce your costs. <strong>Do not</strong> delete the Bastion or any other
cluster object. You <strong>must</strong> destroy the Cluster using the orchestrator.
So feel free to <strong>stop</strong> the instance, but <strong>do not</strong> delete it.</div></blockquote>
<p>When you’re finished with the cluster you can follow the
<a class="reference internal" href="destroying-your-cluster.html"><span class="doc">Destroying a Cluster</span></a> guide to delete it.</p>
</div>
<div class="section" id="cluster-state-files">
<h2>Cluster State Files<a class="headerlink" href="#cluster-state-files" title="Permalink to this headline">¶</a></h2>
<p>The orchestrator state for each cluster is stored in files that are generated
and managed by the execution of <strong>Terraform</strong>, a tool used to create the
cluster objects. These files are located in the orchestrator’s <code class="docutils literal notranslate"><span class="pre">terraform</span></code>
directory and their presence is crucial. <strong>Do not</strong> delete the project or
any files on the terraform directory until you have destroyed the clusters
created from it.</p>
<p>Although remote state storage and state locking is possible,
for this release, the orchestrator does not support such a feature.</p>
<p>For now, remember that your orchestrator directory contains and relies on
a number of dynamic files not under revision control.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="destroying-your-cluster.html" class="btn btn-neutral float-right" title="Destroying a Cluster" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="compiling-machine-images-for-aws.html" class="btn btn-neutral" title="Compiling Machine Images for AWS" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Informatics Matters

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>